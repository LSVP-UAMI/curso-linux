= Redirección y Pipes

== Redirección

=== Comenzamos con una historia

Imaginemos lo siguiente: 

En una cierta escuela, un profesor esté revisando trabajos y, dependiendo de si el trabajo está bien hecho, los niños pueden ser mandados a:

- Un campo de juegos si tienen todo bien.
- Un salón si hay un error en su trabajo.

Cuando se haga el trabajo bien lo representaremos con ‘>’ o con ‘>>’; cuando se haga mal lo representaremos con ‘2>’ o con ‘2>>’

El profesor puede mandar a un niño a estudiar/jugar con sus compañeros al lugar correspondiente o puede mandarlo a avisar a los demás que ya se pueden ir, pero este niño debe quedarse.

Supongamos que Luis está bien, entonces cuando llega al campo de juegues pueden pasar tres cosas:

1. No es el primero en llegar y les dice a los demás compañeros que pueden irse pero él se queda ( > ).
2. No es el primero en llegar y se queda con los demás compañeros ( >> ). 
3. Es el primero en llegar ( > / >> ).

Ahora tenemos que Diego se equivocó, las alternativas son las mismas que antes, solo que irá a un salón en vez del campo de juegos.

1. No es el primero en llegar y les dice a los demás compañeros que pueden irse pero él se queda ( 2> ).
2. No es el primero en llegar y se queda con los demás compañeros ( 2>> ). 
3. Es el primero en llegar ( 2> / 2>> ).

=== Ahora seamos más técnicos

Cada proceso tiene al menos tres canales de comunicación.

* Entrada estándar (STDIN)
* Salida estándar (STDOUT)
* Error estándar (STDERR)

Muchos comandos de UNIX aceptan su entrada desde STDIN y escriben su 
salida a STDOUT. Esto permite enlazar comandos como si se tratara de bloques de construcción.

El shell interpreta los símbolos <, > y >> como instrucciones de redirigir 
las entradas desde algún archivo, al igual que las salidas.

Comportamiento de los operadores <, >, >> y 2>
[cols="1,3"]
|===
|`<`| Usa el contenido de un archivo como STDIN
|`>`| Redirige STDOUT a un archivo, sustituye el contenido previo del archivo
|`>>`| Redirige STDOUT a un archivo, escribe al final del contenido previo del archivo
|`2>`| Redirige STDERR a un archivo
|`2>>`| Redirige STDERR a un archivo, escribe al final del contenido previo del archivo
|===

Uso de los operadores <, >, >>, 2> y 2>>.
[source,shell]
comando < archivo-entrada
comando > archivo-salida
comando >> archivo-salida
comando 2> archivo-error
comando 2>> archivo-error

image::redireccionamiento/redir.png[align=center]

=== Práctica

Primero, obtengamos el material. *En tu home*, copia el directorio *dia3* utilizando el siguiente comando:

[source,shell]
cp -r /tmp/material-curso/dia3/redireccionYPipes .

Ahora realiza las siguientes actividades.

. Copia el contenido del archivo *redireccionYPipes/poesia_artificial* al archivo */home/poesia_redireccionada* usando el comando *cat*. 

. Usa el comando *ls* con un directorio que no exista, y guarda el mensaje de error en un archivo.

. Agrega la linea "Esto es una copia de redireccionYPipes/poesia_artificial" al final del archivo *~/poesia_redireccionada* usando el comando *echo*.

== Pipes

=== Volvemos a comenzar con una historia

Un grupo de amigos se enfrenta a la siguiente tarea: necesitan realizar una serie de operaciones. Son operaciones sencillas: suma, resta, multiplicación, división; sin embargo, el número de operaciones que hay que realizar es muy grande, lo que hace de esta tarea algo tedioso y aburrido. Como no quieren dejar que solo uno de ellos sufra ni tener que hacerlo todos, se les ocurre lo siguiente:

Cada uno de ellos realizará una operación y entonces les dirá al que sigue: “Yo obtuve *este* resultado, ahora te toca a ti hacer *esta* operación”. 

Así se formará una cadena de operaciones. Se irá pasando información de uno a otro y se darán instrucciones acerca de qué hacer con esa información. 

El grupo de amigos hará esto hasta llegar a la última de las operaciones, momento en que obtendrán el resultado. 

De esta manera habrán logrado terminar una tarea que era muy aburrida, de una manera muy sencilla.

Esto es lo que hace un pipe. Después de que un comando ejecuta una acción, se obtiene información y esta información es pasada al siguiente comando para que éste la utilice para trabajar.

=== Volvamos a ser un poco más técnicos

Para enviar la salida estándar de un comando como entrada estándar de otro, 
usamos el símbolo pipe (|), de esta forma se pueden enlazar tantos comandos como se desee.

Uso del operador |
[source,shell]
comando1 | comando2 | comando3

La salida del comando1 es usada como entrada para el comando2 y 
la salida del comando 2 es usada comoentrada para el comando3.

Ejemplo.
[source,shell]
cat /proc/cpuinfo
cat /proc/cpuinfo | head
